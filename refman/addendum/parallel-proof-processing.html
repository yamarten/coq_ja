

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Asynchronous and Parallel Proof Processing &mdash; Coq 8.8.2 ドキュメント</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/fonts.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansi.css" type="text/css" />
  <link rel="stylesheet" href="../_static/coqdoc.css" type="text/css" />
  <link rel="stylesheet" href="../_static/notations.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pre-text.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="Miscellaneous extensions" href="miscellaneous-extensions.html" />
    <link rel="prev" title="Generalized rewriting" href="generalized-rewriting.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Coq
          

          
          </a>

          
            
            
              <div class="version">
                8.8.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">索引</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coq-cmdindex.html">Command index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coq-tacindex.html">Tactic index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coq-optindex.html">Flags, options and tables index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coq-exnindex.html">Errors and warnings index</a></li>
</ul>
<p class="caption"><span class="caption-text">はじめに</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">はじめに</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Credits</a></li>
</ul>
<p class="caption"><span class="caption-text">言語</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/gallina-specification-language.html">The Gallina specification language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/gallina-extensions.html">Extensions of <span class="smallcaps">Gallina</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/coq-library.html">The <span class="smallcaps">Coq</span> library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/cic.html">Calculus of Inductive Constructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/module-system.html">The Module System</a></li>
</ul>
<p class="caption"><span class="caption-text">証明エンジン</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../proof-engine/vernacular-commands.html">Vernacular commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proof-engine/proof-handling.html">Proof handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proof-engine/tactics.html">Tactics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proof-engine/ltac.html">The tactic language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proof-engine/detailed-tactic-examples.html">Detailed examples of tactics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proof-engine/ssreflect-proof-language.html">The <span class="smallcaps">SSReflect</span> proof language</a></li>
</ul>
<p class="caption"><span class="caption-text">ユーザ拡張</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user-extensions/syntax-extensions.html">Syntax extensions and interpretation scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-extensions/proof-schemes.html">Proof schemes</a></li>
</ul>
<p class="caption"><span class="caption-text">実用ツール</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../practical-tools/coq-commands.html">The <span class="smallcaps">Coq</span> commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../practical-tools/utilities.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../practical-tools/coqide.html"><span class="smallcaps">Coq</span> Integrated Development Environment</a></li>
</ul>
<p class="caption"><span class="caption-text">付録</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="extended-pattern-matching.html">Extended pattern matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="implicit-coercions.html">Implicit Coercions</a></li>
<li class="toctree-l1"><a class="reference internal" href="canonical-structures.html">Canonical Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="type-classes.html">Type Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="omega.html">Omega: a solver for quantifier-free problems in Presburger Arithmetic</a></li>
<li class="toctree-l1"><a class="reference internal" href="micromega.html">Micromega: tactics for solving arithmetic goals over ordered rings</a></li>
<li class="toctree-l1"><a class="reference internal" href="extraction.html">Extraction of programs in <span class="smallcaps">OCaml</span> and Haskell</a></li>
<li class="toctree-l1"><a class="reference internal" href="program.html">Program</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring.html">The ring and field tactic families</a></li>
<li class="toctree-l1"><a class="reference internal" href="nsatz.html">Nsatz: tactics for proving equalities in integral domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="generalized-rewriting.html">Generalized rewriting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Asynchronous and Parallel Proof Processing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#proof-annotations">Proof annotations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#automatic-suggestion-of-proof-annotations">Automatic suggestion of proof annotations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#proof-blocks-and-error-resilience">Proof blocks and error resilience</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#caveats">Caveats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-mode">Interactive mode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Caveats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#batch-mode">Batch mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#limiting-the-number-of-parallel-workers">Limiting the number of parallel workers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="miscellaneous-extensions.html">Miscellaneous extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="universe-polymorphism.html">Polymorphic Universes</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../zebibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Coq</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Asynchronous and Parallel Proof Processing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/coq/coq/blob/master/doc/sphinx/addendum/parallel-proof-processing.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="math-preamble math notranslate">
\[\begin{split}\newcommand{\alors}{\textsf{then}}
\newcommand{\alter}{\textsf{alter}}
\newcommand{\as}{\kw{as}}
\newcommand{\Assum}[3]{\kw{Assum}(#1)(#2:#3)}
\newcommand{\bool}{\textsf{bool}}
\newcommand{\case}{\kw{case}}
\newcommand{\conc}{\textsf{conc}}
\newcommand{\cons}{\textsf{cons}}
\newcommand{\consf}{\textsf{consf}}
\newcommand{\conshl}{\textsf{cons\_hl}}
\newcommand{\Def}[4]{\kw{Def}(#1)(#2:=#3:#4)}
\newcommand{\emptyf}{\textsf{emptyf}}
\newcommand{\End}{\kw{End}}
\newcommand{\kwend}{\kw{end}}
\newcommand{\EqSt}{\textsf{EqSt}}
\newcommand{\even}{\textsf{even}}
\newcommand{\evenO}{\textsf{even}_\textsf{O}}
\newcommand{\evenS}{\textsf{even}_\textsf{S}}
\newcommand{\false}{\textsf{false}}
\newcommand{\filter}{\textsf{filter}}
\newcommand{\Fix}{\kw{Fix}}
\newcommand{\fix}{\kw{fix}}
\newcommand{\for}{\textsf{for}}
\newcommand{\forest}{\textsf{forest}}
\newcommand{\from}{\textsf{from}}
\newcommand{\Functor}{\kw{Functor}}
\newcommand{\haslength}{\textsf{has\_length}}
\newcommand{\hd}{\textsf{hd}}
\newcommand{\ident}{\textsf{ident}}
\newcommand{\In}{\kw{in}}
\newcommand{\Ind}[4]{\kw{Ind}[#2](#3:=#4)}
\newcommand{\ind}[3]{\kw{Ind}~[#1]\left(#2\mathrm{~:=~}#3\right)}
\newcommand{\Indp}[5]{\kw{Ind}_{#5}(#1)[#2](#3:=#4)}
\newcommand{\Indpstr}[6]{\kw{Ind}_{#5}(#1)[#2](#3:=#4)/{#6}}
\newcommand{\injective}{\kw{injective}}
\newcommand{\kw}[1]{\textsf{#1}}
\newcommand{\lb}{\lambda}
\newcommand{\length}{\textsf{length}}
\newcommand{\letin}[3]{\kw{let}~#1:=#2~\kw{in}~#3}
\newcommand{\List}{\textsf{list}}
\newcommand{\lra}{\longrightarrow}
\newcommand{\Match}{\kw{match}}
\newcommand{\Mod}[3]{{\kw{Mod}}({#1}:{#2}\,\zeroone{:={#3}})}
\newcommand{\ModA}[2]{{\kw{ModA}}({#1}=={#2})}
\newcommand{\ModS}[2]{{\kw{Mod}}({#1}:{#2})}
\newcommand{\ModType}[2]{{\kw{ModType}}({#1}:={#2})}
\newcommand{\mto}{.\;}
\newcommand{\Nat}{\mathbb{N}}
\newcommand{\nat}{\textsf{nat}}
\newcommand{\Nil}{\textsf{nil}}
\newcommand{\nilhl}{\textsf{nil\_hl}}
\newcommand{\nO}{\textsf{O}}
\newcommand{\node}{\textsf{node}}
\newcommand{\nS}{\textsf{S}}
\newcommand{\odd}{\textsf{odd}}
\newcommand{\oddS}{\textsf{odd}_\textsf{S}}
\newcommand{\ovl}[1]{\overline{#1}}
\newcommand{\Pair}{\textsf{pair}}
\newcommand{\Prod}{\textsf{prod}}
\newcommand{\Prop}{\textsf{Prop}}
\newcommand{\return}{\kw{return}}
\newcommand{\Set}{\textsf{Set}}
\newcommand{\si}{\textsf{if}}
\newcommand{\sinon}{\textsf{else}}
\newcommand{\Sort}{\cal S}
\newcommand{\Str}{\textsf{Stream}}
\newcommand{\Struct}{\kw{Struct}}
\newcommand{\subst}[3]{#1\{#2/#3\}}
\newcommand{\tl}{\textsf{tl}}
\newcommand{\tree}{\textsf{tree}}
\newcommand{\true}{\textsf{true}}
\newcommand{\Type}{\textsf{Type}}
\newcommand{\unfold}{\textsf{unfold}}
\newcommand{\WEV}[3]{\mbox{$#1[] \vdash #2 \lra  #3$}}
\newcommand{\WEVT}[3]{\mbox{$#1[] \vdash #2 \lra$}\\ \mbox{$ #3$}}
\newcommand{\WF}[2]{{\cal W\!F}(#1)[#2]}
\newcommand{\WFE}[1]{\WF{E}{#1}}
\newcommand{\WFT}[2]{#1[] \vdash {\cal W\!F}(#2)}
\newcommand{\WFTWOLINES}[2]{{\cal W\!F}\begin{array}{l}(#1)\\\mbox{}[{#2}]\end{array}}
\newcommand{\with}{\kw{with}}
\newcommand{\WS}[3]{#1[] \vdash #2 &lt;: #3}
\newcommand{\WSE}[2]{\WS{E}{#1}{#2}}
\newcommand{\WT}[4]{#1[#2] \vdash #3 : #4}
\newcommand{\WTE}[3]{\WT{E}{#1}{#2}{#3}}
\newcommand{\WTEG}[2]{\WTE{\Gamma}{#1}{#2}}
\newcommand{\WTM}[3]{\WT{#1}{}{#2}{#3}}
\newcommand{\zeroone}[1]{[{#1}]}
\newcommand{\zeros}{\textsf{zeros}}
\end{split}\]</div>
<div class="section" id="asynchronous-and-parallel-proof-processing">
<span id="asynchronousandparallelproofprocessing"></span><h1>Asynchronous and Parallel Proof Processing<a class="headerlink" href="#asynchronous-and-parallel-proof-processing" title="このヘッドラインへのパーマリンク">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Enrico Tassi</td>
</tr>
</tbody>
</table>
<p>This chapter explains how proofs can be asynchronously processed by
<span class="smallcaps">Coq</span>. This feature improves the reactivity of the system when used in
interactive mode via <span class="smallcaps">CoqIDE</span>. In addition, it allows <span class="smallcaps">Coq</span> to take
advantage of parallel hardware when used as a batch compiler by
decoupling the checking of statements and definitions from the
construction and checking of proofs objects.</p>
<p>This feature is designed to help dealing with huge libraries of
theorems characterized by long proofs. In the current state, it may
not be beneficial on small sets of short files.</p>
<p>This feature has some technical limitations that may make it
unsuitable for some use cases.</p>
<p>For example, in interactive mode, some errors coming from the kernel
of <span class="smallcaps">Coq</span> are signaled late. The type of errors belonging to this
category are universe inconsistencies.</p>
<p>At the time of writing, only opaque proofs (ending with <code class="docutils literal notranslate"><span class="pre">Qed</span></code> or
<code class="docutils literal notranslate"><span class="pre">Admitted</span></code>) can be processed asynchronously.</p>
<p>Finally, asynchronous processing is disabled when running <span class="smallcaps">CoqIDE</span> in
Windows. The current implementation of the feature is not stable on
Windows. It can be enabled, as described below at <a class="reference internal" href="#interactive-mode"><span class="std std-ref">Interactive mode</span></a>,
though doing so is not recommended.</p>
<div class="section" id="proof-annotations">
<h2>Proof annotations<a class="headerlink" href="#proof-annotations" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>To process a proof asynchronously <span class="smallcaps">Coq</span> needs to know the precise
statement of the theorem without looking at the proof. This requires
some annotations if the theorem is proved inside a Section (see
Section <a class="reference internal" href="../language/gallina-extensions.html#section-mechanism"><span class="std std-ref">Section mechanism</span></a>).</p>
<p>When a section ends, <span class="smallcaps">Coq</span> looks at the proof object to decide which
section variables are actually used and hence have to be quantified in
the statement of the theorem. To avoid making the construction of
proofs mandatory when ending a section, one can start each proof with
the <code class="docutils literal notranslate"><span class="pre">Proof</span> <span class="pre">using</span></code> command (Section <a class="reference internal" href="../proof-engine/proof-handling.html#proof-editing-mode"><span class="std std-ref">Switching on/off the proof editing mode</span></a>) that
declares which section variables the theorem uses.</p>
<p>The presence of <code class="docutils literal notranslate"><span class="pre">Proof</span></code> using is needed to process proofs asynchronously
in interactive mode.</p>
<p>It is not strictly mandatory in batch mode if it is not the first time
the file is compiled and if the file itself did not change. When the
proof does not begin with Proof using, the system records in an
auxiliary file, produced along with the <cite>.vo</cite> file, the list of section
variables used.</p>
<div class="section" id="automatic-suggestion-of-proof-annotations">
<h3>Automatic suggestion of proof annotations<a class="headerlink" href="#automatic-suggestion-of-proof-annotations" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>The flag <a class="reference internal" href="../proof-engine/proof-handling.html#coq:flag.suggest-proof-using" title="Suggest Proof Using"><code class="xref coq coq-flag docutils literal notranslate"><span class="pre">Suggest</span> <span class="pre">Proof</span> <span class="pre">Using</span></code></a> makes <span class="smallcaps">Coq</span> suggest, when a <code class="docutils literal notranslate"><span class="pre">Qed</span></code>
command is processed, a correct proof annotation. It is up to the user
to modify the proof script accordingly.</p>
</div>
</div>
<div class="section" id="proof-blocks-and-error-resilience">
<h2>Proof blocks and error resilience<a class="headerlink" href="#proof-blocks-and-error-resilience" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><span class="smallcaps">Coq</span> 8.6 introduced a mechanism for error resilience: in interactive
mode <span class="smallcaps">Coq</span> is able to completely check a document containing errors
instead of bailing out at the first failure.</p>
<p>Two kind of errors are supported: errors occurring in vernacular
commands and errors occurring in proofs.</p>
<p>To properly recover from a failing tactic, <span class="smallcaps">Coq</span> needs to recognize the
structure of the proof in order to confine the error to a sub proof.
Proof block detection is performed by looking at the syntax of the
proof script (i.e. also looking at indentation). <span class="smallcaps">Coq</span> comes with four
kind of proof blocks, and an ML API to add new ones.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">curly:</th><td class="field-body">blocks are delimited by { and }, see Chapter <a class="reference internal" href="../proof-engine/proof-handling.html#proofhandling"><span class="std std-ref">Proof handling</span></a></td>
</tr>
<tr class="field-even field"><th class="field-name">par:</th><td class="field-body">blocks are atomic, i.e. just one tactic introduced by the <cite>par:</cite>
goal selector</td>
</tr>
<tr class="field-odd field"><th class="field-name">indent:</th><td class="field-body">blocks end with a tactic indented less than the previous one</td>
</tr>
<tr class="field-even field"><th class="field-name">bullet:</th><td class="field-body">blocks are delimited by two equal bullet signs at the same
indentation level</td>
</tr>
</tbody>
</table>
<div class="section" id="caveats">
<h3>Caveats<a class="headerlink" href="#caveats" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>When a vernacular command fails the subsequent error messages may be
bogus, i.e. caused by the first error. Error resilience for vernacular
commands can be switched off by passing <code class="docutils literal notranslate"><span class="pre">-async-proofs-command-error-resilience</span> <span class="pre">off</span></code>
to <span class="smallcaps">CoqIDE</span>.</p>
<p>An incorrect proof block detection can result into an incorrect error
recovery and hence in bogus errors. Proof block detection cannot be
precise for bullets or any other non well parenthesized proof
structure. Error resilience can be turned off or selectively activated
for any set of block kind passing to <span class="smallcaps">CoqIDE</span> one of the following
options:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-async-proofs-tactic-error-resilience</span> <span class="pre">off</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">-async-proofs-tactic-error-resilience</span> <span class="pre">all</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">-async-proofs-tactic-error-resilience</span></code> <code class="docutils literal notranslate"><span class="notation"><span class="repeat-wrapper"><span class="repeat"><span><span class="pre">blocktype</span></span></span><span class="notation-sup"><span class="pre">*</span></span><span class="notation-sub"><span class="pre">,</span></span></span></span></code></li>
</ul>
<p>Valid proof block types are: “curly”, “par”, “indent”, and “bullet”.</p>
</div>
</div>
<div class="section" id="interactive-mode">
<span id="id1"></span><h2>Interactive mode<a class="headerlink" href="#interactive-mode" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>At the time of writing the only user interface supporting asynchronous
proof processing is <span class="smallcaps">CoqIDE</span>.</p>
<p>When <span class="smallcaps">CoqIDE</span> is started, two <span class="smallcaps">Coq</span> processes are created. The master one
follows the user, giving feedback as soon as possible by skipping
proofs, which are delegated to the worker process. The worker process,
whose state can be seen by clicking on the button in the lower right
corner of the main <span class="smallcaps">CoqIDE</span> window, asynchronously processes the proofs.
If a proof contains an error, it is reported in red in the label of
the very same button, that can also be used to see the list of errors
and jump to the corresponding line.</p>
<p>If a proof is processed asynchronously the corresponding Qed command
is colored using a lighter color than usual. This signals that the
proof has been delegated to a worker process (or will be processed
lazily if the <code class="docutils literal notranslate"><span class="pre">-async-proofs</span> <span class="pre">lazy</span></code> option is used). Once finished, the
worker process will provide the proof object, but this will not be
automatically checked by the kernel of the main process. To force the
kernel to check all the proof objects, one has to click the button
with the gears (Fully check the document) on the top bar.
Only then all the universe constraints are checked.</p>
<div class="section" id="id2">
<h3>Caveats<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>The number of worker processes can be increased by passing <span class="smallcaps">CoqIDE</span>
the <code class="docutils literal notranslate"><span class="pre">-async-proofs-j</span> <span class="pre">n</span></code> flag. Note that the memory consumption increases too,
since each worker requires the same amount of memory as the master
process. Also note that increasing the number of workers may reduce
the reactivity of the master process to user commands.</p>
<p>To disable this feature, one can pass the <code class="docutils literal notranslate"><span class="pre">-async-proofs</span> <span class="pre">off</span></code> flag to
<span class="smallcaps">CoqIDE</span>. Conversely, on Windows, where the feature is disabled by
default, pass the <code class="docutils literal notranslate"><span class="pre">-async-proofs</span> <span class="pre">on</span></code> flag to enable it.</p>
<p>Proofs that are known to take little time to process are not delegated
to a worker process. The threshold can be configured with
<code class="docutils literal notranslate"><span class="pre">-async-proofs-delegation-threshold</span></code>. Default is 0.03 seconds.</p>
</div>
</div>
<div class="section" id="batch-mode">
<h2>Batch mode<a class="headerlink" href="#batch-mode" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>When <span class="smallcaps">Coq</span> is used as a batch compiler by running <cite>coqc</cite> or <cite>coqtop</cite>
-compile, it produces a <cite>.vo</cite> file for each <cite>.v</cite> file. A <cite>.vo</cite> file contains,
among other things, theorem statements and proofs. Hence to produce a
.vo <span class="smallcaps">Coq</span> need to process all the proofs of the <cite>.v</cite> file.</p>
<p>The asynchronous processing of proofs can decouple the generation of a
compiled file (like the <cite>.vo</cite> one) that can be loaded by <code class="docutils literal notranslate"><span class="pre">Require</span></code> from the
generation and checking of the proof objects. The <code class="docutils literal notranslate"><span class="pre">-quick</span></code> flag can be
passed to <cite>coqc</cite> or <cite>coqtop</cite> to produce, quickly, <cite>.vio</cite> files.
Alternatively, when using a Makefile produced by <cite>coq_makefile</cite>,
the <code class="docutils literal notranslate"><span class="pre">quick</span></code> target can be used to compile all files using the <code class="docutils literal notranslate"><span class="pre">-quick</span></code> flag.</p>
<p>A <cite>.vio</cite> file can be loaded using <code class="docutils literal notranslate"><span class="pre">Require</span></code> exactly as a <cite>.vo</cite> file but
proofs will not be available (the Print command produces an error).
Moreover, some universe constraints might be missing, so universes
inconsistencies might go unnoticed. A <cite>.vio</cite> file does not contain proof
objects, but proof tasks, i.e. what a worker process can transform
into a proof object.</p>
<p>Compiling a set of files with the <code class="docutils literal notranslate"><span class="pre">-quick</span></code> flag allows one to work,
interactively, on any file without waiting for all the proofs to be
checked.</p>
<p>When working interactively, one can fully check all the <cite>.v</cite> files by
running <cite>coqc</cite> as usual.</p>
<p>Alternatively one can turn each <cite>.vio</cite> into the corresponding <cite>.vo</cite>. All
.vio files can be processed in parallel, hence this alternative might
be faster. The command <code class="docutils literal notranslate"><span class="pre">coqtop</span> <span class="pre">-schedule-vio2vo</span> <span class="pre">2</span> <span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code> can be used to
obtain a good scheduling for two workers to produce <cite>a.vo</cite>, <cite>b.vo</cite>, and
<cite>c.vo</cite>. When using a Makefile produced by <cite>coq_makefile</cite>, the <code class="docutils literal notranslate"><span class="pre">vio2vo</span></code> target
can be used for that purpose. Variable <cite>J</cite> should be set to the number
of workers, e.g. <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">vio2vo</span> <span class="pre">J=2</span></code>. The only caveat is that, while the
.vo files obtained from <cite>.vio</cite> files are complete (they contain all proof
terms and universe constraints), the satisfiability of all universe
constraints has not been checked globally (they are checked to be
consistent for every single proof). Constraints will be checked when
these <cite>.vo</cite> files are (recursively) loaded with <code class="docutils literal notranslate"><span class="pre">Require</span></code>.</p>
<p>There is an extra, possibly even faster, alternative: just check the
proof tasks stored in <cite>.vio</cite> files without producing the <cite>.vo</cite> files. This
is possibly faster because all the proof tasks are independent, hence
one can further partition the job to be done between workers. The
<code class="docutils literal notranslate"><span class="pre">coqtop</span> <span class="pre">-schedule-vio-checking</span> <span class="pre">6</span> <span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code> command can be used to obtain a
good scheduling for 6 workers to check all the proof tasks of <cite>a.vio</cite>,
<cite>b.vio</cite>, and <cite>c.vio</cite>. Auxiliary files are used to predict how long a proof
task will take, assuming it will take the same amount of time it took
last time. When using a Makefile produced by coq_makefile, the
<code class="docutils literal notranslate"><span class="pre">checkproofs</span></code> target can be used to check all <cite>.vio</cite> files. Variable <cite>J</cite>
should be set to the number of workers, e.g. <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">checkproofs</span> <span class="pre">J=6</span></code>. As
when converting <cite>.vio</cite> files to <cite>.vo</cite> files, universe constraints are not
checked to be globally consistent. Hence this compilation mode is only
useful for quick regression testing and on developments not making
heavy use of the <cite>Type</cite> hierarchy.</p>
</div>
<div class="section" id="limiting-the-number-of-parallel-workers">
<h2>Limiting the number of parallel workers<a class="headerlink" href="#limiting-the-number-of-parallel-workers" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Many <span class="smallcaps">Coq</span> processes may run on the same computer, and each of them may
start many additional worker processes. The <cite>coqworkmgr</cite> utility lets
one limit the number of workers, globally.</p>
<p>The utility accepts the <code class="docutils literal notranslate"><span class="pre">-j</span></code> argument to specify the maximum number of
workers (defaults to 2). <cite>coqworkmgr</cite> automatically starts in the
background and prints an environment variable assignment
like <code class="docutils literal notranslate"><span class="pre">COQWORKMGR_SOCKET=localhost:45634</span></code>. The user must set this variable
in all the shells from which <span class="smallcaps">Coq</span> processes will be started. If one
uses just one terminal running the bash shell, then
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">‘coqworkmgr</span> <span class="pre">-j</span> <span class="pre">4‘</span></code> will do the job.</p>
<p>After that, all <span class="smallcaps">Coq</span> processes, e.g. <cite>coqide</cite> and <cite>coqc</cite>, will respect the
limit, globally.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="miscellaneous-extensions.html" class="btn btn-neutral float-right" title="Miscellaneous extensions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="generalized-rewriting.html" class="btn btn-neutral" title="Generalized rewriting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 1999-2018, Inria.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'8.8.2',
            LANGUAGE:'ja',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/notations.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>